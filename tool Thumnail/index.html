<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YBNThumb AI - Gemini 2.0 Technology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkbg: '#09090b', // ƒêen s√¢u h∆°n
                        darkcard: '#18181b', // Card n·ªïi
                        accent: '#3b82f6', // Xanh 2.0
                        highlight: '#eab308' // V√†ng
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #09090b; color: #e4e4e7; font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #18181b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        /* Hi·ªáu ·ª©ng load gradient m·ªõi */
        .loader {
            border: 4px solid #27272a;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .glass-effect { background: rgba(24, 24, 27, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen custom-scrollbar">

    <div id="apiKeyModal" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center hidden">
        <div class="bg-darkcard p-8 rounded-2xl border border-gray-800 w-full max-w-md shadow-2xl">
            <h2 class="text-xl font-bold text-white mb-2 flex items-center">
                <span class="text-blue-500 mr-2">‚ö°</span> C·∫•u h√¨nh Gemini 2.0
            </h2>
            <p class="text-gray-400 text-sm mb-4">Nh·∫≠p API Key ƒë·ªÉ k√≠ch ho·∫°t model th·∫ø h·ªá m·ªõi.</p>
            <input type="password" id="apiKeyInput" placeholder="D√°n API Key (AIza...)" class="w-full bg-black/50 border border-gray-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none mb-4 transition">
            <div class="flex gap-3">
                <button onclick="saveApiKey()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">K·∫øt n·ªëi</button>
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-gray-400 flex items-center justify-center underline hover:text-white">L·∫•y key mi·ªÖn ph√≠</a>
            </div>
        </div>
    </div>

    <header class="border-b border-gray-800 bg-darkbg/80 backdrop-blur-md sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-tr from-blue-600 to-cyan-400 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white tracking-tight">YBNThumb <span class="text-blue-500">2.0</span></h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest font-semibold">Gemini Flash Exp Thinking</p>
                </div>
            </div>
            <button onclick="clearKey()" class="text-xs text-gray-500 hover:text-white transition">ƒê·ªïi API Key</button>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-8 pb-20">

        <section id="step1" class="mb-10 animate-fade-in">
            <div class="bg-darkcard border border-gray-800 rounded-2xl p-1 shadow-2xl">
                <div class="bg-darkbg/50 rounded-xl p-6">
                    <label class="block text-sm font-medium text-blue-400 mb-3">N·ªôi dung video / √ù t∆∞·ªüng</label>
                    <textarea id="videoInput" rows="4" class="w-full bg-[#09090b] border border-gray-800 rounded-xl p-4 text-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition resize-none text-lg placeholder-gray-600" placeholder="M√¥ t·∫£ video c·ªßa b·∫°n... (V√≠ d·ª•: B√≠ ·∫©n kim t·ª± th√°p, phong c√°ch huy·ªÅn b√≠)"></textarea>
                    
                    <div class="flex flex-col md:flex-row justify-between items-center mt-4 gap-4">
                        <div class="relative w-full md:w-auto group">
                            <label class="flex items-center justify-center gap-2 px-4 py-2 bg-gray-900 border border-gray-800 rounded-lg cursor-pointer hover:border-gray-600 transition text-sm text-gray-400 group-hover:text-white">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                <span id="imageLabel">Ph√¢n t√≠ch t·ª´ ·∫£nh (T√πy ch·ªçn)</span>
                                <input type="file" id="imageInput" class="hidden" accept="image/*" onchange="document.getElementById('imageLabel').innerText = 'ƒê√£ ch·ªçn: ' + this.files[0].name; document.getElementById('imageLabel').classList.add('text-blue-400')">
                            </label>
                        </div>

                        <button onclick="analyzeContent()" id="analyzeBtn" class="w-full md:w-auto bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-bold px-8 py-3 rounded-xl shadow-lg shadow-blue-900/30 transition transform active:scale-95 flex items-center justify-center gap-2">
                            <span>K√≠ch ho·∫°t T∆∞ duy AI</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div id="loadingUI" class="hidden flex flex-col items-center justify-center py-12">
            <div class="loader mb-6"></div>
            <p class="text-gray-300 font-medium">Gemini 2.0 ƒëang suy lu·∫≠n...</p>
            <p class="text-gray-600 text-xs mt-2">Ph√¢n t√≠ch ng·ªØ c·∫£nh & t·ªëi ∆∞u CTR</p>
        </div>

        <section id="step2" class="hidden space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-darkcard border border-gray-800 rounded-2xl p-6 hover:border-blue-900/50 transition">
                    <h3 class="text-blue-500 font-bold text-xs uppercase tracking-widest mb-3">üíé Chi·∫øn l∆∞·ª£c c·ªët l√µi</h3>
                    <p id="strategyText" class="text-gray-300 text-sm leading-relaxed"></p>
                </div>
                <div class="bg-darkcard border border-gray-800 rounded-2xl p-6 hover:border-purple-900/50 transition">
                    <h3 class="text-purple-500 font-bold text-xs uppercase tracking-widest mb-3">üß† ƒê√°nh v√†o t√¢m l√Ω</h3>
                    <p id="reasoningText" class="text-gray-400 text-sm italic leading-relaxed"></p>
                </div>
            </div>

            <div class="bg-darkcard border border-gray-800 rounded-2xl p-6">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-white font-bold">Text G√¢y T√≤ M√≤ (Hooks)</h3>
                    <span class="text-xs text-gray-500">ƒê∆∞·ª£c ch·∫•m ƒëi·ªÉm CTR b·ªüi AI</span>
                </div>
                <div id="textOptionsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    </div>
                <div class="mt-4 relative">
                    <input type="text" id="customTextInput" placeholder="Ho·∫∑c nh·∫≠p text c·ªßa b·∫°n v√†o ƒë√¢y..." class="w-full bg-[#09090b] border border-gray-800 rounded-lg pl-4 pr-10 py-3 text-sm text-white focus:border-blue-500 transition">
                    <div class="absolute right-3 top-3 text-gray-600">‚úçÔ∏è</div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-darkcard border border-gray-800 rounded-xl p-4">
                    <label class="text-xs text-gray-500 block mb-2">Ch·ªß th·ªÉ</label>
                    <select id="subjectSelect" class="w-full bg-[#09090b] text-white text-sm border-none focus:ring-0 p-0 cursor-pointer">
                        <option value="T·ª± (Ch√¢n dung)">üë§ T·ª± (Self)</option>
                        <option value="Nam bi·ªÉu c·∫£m">üôé‚Äç‚ôÇÔ∏è Nam</option>
                        <option value="N·ªØ bi·ªÉu c·∫£m">üôé‚Äç‚ôÄÔ∏è N·ªØ</option>
                        <option value="V·∫≠t th·ªÉ/S·∫£n ph·∫©m">üì¶ S·∫£n ph·∫©m</option>
                        <option value="Phong c·∫£nh/N·ªÅn">üåÑ C·∫£nh v·∫≠t</option>
                    </select>
                </div>
                <div class="bg-darkcard border border-gray-800 rounded-xl p-4">
                    <label class="text-xs text-gray-500 block mb-2">Style Text</label>
                    <select id="textStyleSelect" class="w-full bg-[#09090b] text-white text-sm border-none focus:ring-0 p-0 cursor-pointer">
                        <option value="3D Kh·ªëi N·ªïi">‚ú® 3D N·ªïi</option>
                        <option value="Neon Ph√°t S√°ng">üí° Neon</option>
                        <option value="Kinh d·ªã/M√°u">ü©∏ Kinh d·ªã</option>
                        <option value="Sang tr·ªçng/V√†ng">üëë Luxury</option>
                        <option value="T·ªëi gi·∫£n/Hi·ªán ƒë·∫°i">‚ö™ T·ªëi gi·∫£n</option>
                    </select>
                </div>
                <div class="bg-darkcard border border-gray-800 rounded-xl p-4">
                    <label class="text-xs text-gray-500 block mb-2">C·∫£m x√∫c</label>
                    <select id="emotionSelect" class="w-full bg-[#09090b] text-white text-sm border-none focus:ring-0 p-0 cursor-pointer">
                        <option value="S·ªëc c·ª±c ƒë·ªô">üò± S·ªëc</option>
                        <option value="S·ª£ h√£i/Ho·∫£ng lo·∫°n">üëª S·ª£ h√£i</option>
                        <option value="T·ª©c gi·∫≠n/Gay g·∫Øt">üò° T·ª©c gi·∫≠n</option>
                        <option value="H·∫°nh ph√∫c/C∆∞·ªùi">üòÑ Vui v·∫ª</option>
                        <option value="B√≠ ·∫©n/Tr·∫ßm t∆∞">ü§î B√≠ ·∫©n</option>
                    </select>
                </div>
                <div class="bg-darkcard border border-gray-800 rounded-xl p-4">
                    <label class="text-xs text-gray-500 block mb-2">ƒê·ªì h·ªça</label>
                    <select id="artStyleSelect" class="w-full bg-[#09090b] text-white text-sm border-none focus:ring-0 p-0 cursor-pointer">
                        <option value="Hyper-realistic 8k">üì∏ Si√™u th·∫≠t</option>
                        <option value="3D Disney/Pixar">üé® 3D Pixar</option>
                        <option value="Cinematic Dark">üé¨ ƒêi·ªán ·∫£nh t·ªëi</option>
                        <option value="Cyberpunk Neon">ü§ñ Cyberpunk</option>
                        <option value="Anime Style">üå∏ Anime</option>
                    </select>
                </div>
            </div>

            <div>
                 <input type="text" id="extraNote" placeholder="Ghi ch√∫ th√™m cho AI (VD: Background m√†u ƒë·ªè, tr·ªùi m∆∞a...)" class="w-full bg-darkcard border border-gray-800 rounded-xl p-4 text-sm text-gray-300 focus:border-blue-500 transition">
            </div>

            <div class="flex justify-end gap-4 pt-4 border-t border-gray-800/50">
                <button onclick="resetFlow()" class="text-gray-500 hover:text-white text-sm px-4">L√†m l·∫°i</button>
                <button onclick="generateFinalPrompt()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold px-8 py-3 rounded-xl shadow-lg shadow-blue-600/20 transition transform hover:-translate-y-1">
                    T·∫°o Prompt (Gemini 2.0)
                </button>
            </div>
        </section>

        <section id="step3" class="hidden space-y-6">
            <div class="bg-darkcard border border-gray-700 rounded-2xl overflow-hidden shadow-2xl">
                <div class="flex border-b border-gray-700">
                    <div class="px-6 py-4 border-b-2 border-blue-500 text-blue-400 font-bold text-sm">Midjourney / DALL-E 3</div>
                    <div class="px-6 py-4 text-gray-500 text-sm">English Prompt</div>
                </div>
                
                <div class="p-6 bg-[#09090b] relative group">
                    <p id="englishPrompt" class="text-gray-300 font-mono text-sm leading-7 select-all">...</p>
                    <button onclick="copyText('englishPrompt')" class="absolute top-4 right-4 bg-gray-800 hover:bg-gray-700 text-white text-xs px-3 py-1 rounded border border-gray-600 opacity-0 group-hover:opacity-100 transition">Copy</button>
                </div>
            </div>

            <div class="bg-darkcard border border-gray-800 rounded-2xl p-6">
                <h3 class="text-gray-400 font-bold text-xs uppercase tracking-widest mb-3">M√¥ t·∫£ chi ti·∫øt (Ti·∫øng Vi·ªát)</h3>
                <p id="vietnamesePrompt" class="text-gray-400 text-sm leading-relaxed"></p>
            </div>

            <button onclick="document.getElementById('step3').classList.add('hidden'); document.getElementById('step2').classList.remove('hidden');" class="w-full py-4 text-gray-500 hover:text-white text-sm">‚¨Ö Quay l·∫°i ch·ªânh s·ª≠a</button>
        </section>

    </main>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // --- C·∫§U H√åNH MODEL M·ªöI NH·∫§T ---
        // S·ª≠ d·ª•ng gemini-2.0-flash-exp cho t·ªëc ƒë·ªô v√† tr√≠ tu·ªá m·ªõi nh·∫•t
        const MODEL_NAME = "gemini-2.0-flash-exp"; 

        window.saveApiKey = function() {
            const key = document.getElementById('apiKeyInput').value;
            if(key) {
                localStorage.setItem('gemini_api_key', key);
                document.getElementById('apiKeyModal').classList.add('hidden');
            }
        }

        window.clearKey = function() {
            localStorage.removeItem('gemini_api_key');
            location.reload();
        }

        window.copyText = function(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText);
            alert("ƒê√£ sao ch√©p prompt!");
        }

        window.selectHook = function(text, el) {
            document.getElementById('customTextInput').value = text;
            document.querySelectorAll('.hook-item').forEach(d => d.className = "hook-item bg-[#09090b] border border-gray-800 p-4 rounded-xl cursor-pointer hover:border-gray-600 transition");
            el.className = "hook-item bg-blue-900/20 border border-blue-500/50 p-4 rounded-xl cursor-pointer transition";
        }

        window.resetFlow = function() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step1').classList.remove('hidden');
        }

        // --- H√ÄM X·ª¨ L√ù JSON TH√îNG MINH (Tr√°nh l·ªói model n√≥i nhi·ªÅu) ---
        function cleanAndParseJSON(text) {
            // T√¨m v·ªã tr√≠ b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c c·ªßa JSON object
            const firstBrace = text.indexOf('{');
            const lastBrace = text.lastIndexOf('}');
            
            if (firstBrace !== -1 && lastBrace !== -1) {
                // Ch·ªâ l·∫•y ph·∫ßn n·∫±m trong {}
                const jsonString = text.substring(firstBrace, lastBrace + 1);
                return JSON.parse(jsonString);
            }
            throw new Error("Kh√¥ng t√¨m th·∫•y JSON h·ª£p l·ªá trong ph·∫£n h·ªìi c·ªßa AI.");
        }

        // --- STEP 1: ANALYZE ---
        window.analyzeContent = async function() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if(!apiKey) return document.getElementById('apiKeyModal').classList.remove('hidden');

            const input = document.getElementById('videoInput').value;
            if(!input) return alert("H√£y nh·∫≠p √Ω t∆∞·ªüng video!");

            document.getElementById('step1').classList.add('hidden');
            document.getElementById('loadingUI').classList.remove('hidden');

            try {
                const genAI = new GoogleGenerativeAI(apiKey);
                const model = genAI.getGenerativeModel({ model: MODEL_NAME });

                const prompt = `
                Analyze YouTube video idea: "${input}".
                Act as a viral strategist. Return strictly JSON:
                {
                    "strategy": "Vietnamese strategy explanation (max 30 words)",
                    "reasoning": "Psychological trigger explanation (Vietnamese)",
                    "hooks": [
                        {"text": "Short Hook 1", "ctr": 95},
                        {"text": "Short Hook 2", "ctr": 88},
                        {"text": "Short Hook 3", "ctr": 82}
                    ]
                }
                `;

                const result = await model.generateContent(prompt);
                const data = cleanAndParseJSON(result.response.text());

                document.getElementById('loadingUI').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                
                document.getElementById('strategyText').innerText = data.strategy;
                document.getElementById('reasoningText').innerText = data.reasoning;
                
                const container = document.getElementById('textOptionsContainer');
                container.innerHTML = '';
                data.hooks.forEach(h => {
                    const div = document.createElement('div');
                    div.className = "hook-item bg-[#09090b] border border-gray-800 p-4 rounded-xl cursor-pointer hover:border-gray-600 transition";
                    div.onclick = () => window.selectHook(h.text, div);
                    div.innerHTML = `<div class="font-bold text-white text-sm mb-1">"${h.text}"</div><div class="text-xs text-green-500 font-mono">üî• CTR: ${h.ctr}%</div>`;
                    container.appendChild(div);
                });

            } catch (e) {
                alert("L·ªói: " + e.message);
                window.resetFlow();
            }
        }

        // --- STEP 2: GENERATE ---
        window.generateFinalPrompt = async function() {
            const apiKey = localStorage.getItem('gemini_api_key');
            const note = document.getElementById('extraNote').value;
            const text = document.getElementById('customTextInput').value || "TEXT";
            
            // Get values
            const subject = document.getElementById('subjectSelect').value;
            const style = document.getElementById('artStyleSelect').value;
            const emotion = document.getElementById('emotionSelect').value;
            const textStyle = document.getElementById('textStyleSelect').value;

            document.getElementById('step2').classList.add('hidden');
            document.getElementById('loadingUI').classList.remove('hidden');

            try {
                const genAI = new GoogleGenerativeAI(apiKey);
                const model = genAI.getGenerativeModel({ model: MODEL_NAME });

                const prompt = `
                Create High-CTR YouTube Thumbnail Prompt.
                Context: Subject=${subject}, Emotion=${emotion}, ArtStyle=${style}.
                Overlay Text: "${text}" (Style: ${textStyle}).
                User Note: ${note}.
                
                Return strictly JSON:
                {
                    "midjourney_prompt": "English prompt for Midjourney v6, highly detailed, describing lighting, composition, 8k...",
                    "vietnamese_desc": "Vietnamese visual description"
                }
                `;

                const result = await model.generateContent(prompt);
                const data = cleanAndParseJSON(result.response.text());

                document.getElementById('loadingUI').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
                
                document.getElementById('englishPrompt').innerText = data.midjourney_prompt + " --ar 16:9 --v 6.0 --style raw";
                document.getElementById('vietnamesePrompt').innerText = data.vietnamese_desc;

            } catch (e) {
                alert("L·ªói t·∫°o prompt: " + e.message);
                document.getElementById('step2').classList.remove('hidden');
                document.getElementById('loadingUI').classList.add('hidden');
            }
        }

        // Check key on load
        if(!localStorage.getItem('gemini_api_key')) document.getElementById('apiKeyModal').classList.remove('hidden');
    </script>
</body>
</html>
