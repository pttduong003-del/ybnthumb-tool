<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YBNThumb AI - Gemini 2.0 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkbg: '#09090b', 
                        darkcard: '#18181b', 
                        accent: '#3b82f6'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #09090b; color: #e4e4e7; font-family: 'Inter', sans-serif; }
        .loader {
            border: 4px solid #27272a;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen">

    <div id="apiKeyModal" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center hidden">
        <div class="bg-darkcard p-8 rounded-2xl border border-gray-800 w-full max-w-md">
            <h2 class="text-xl font-bold text-white mb-4">üîë K·∫øt n·ªëi Gemini 2.0</h2>
            <input type="password" id="apiKeyInput" placeholder="D√°n API Key v√†o ƒë√¢y..." class="w-full bg-black/50 border border-gray-700 rounded-lg p-3 text-white mb-4">
            <button onclick="saveApiKey()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg">L∆∞u & B·∫Øt ƒë·∫ßu</button>
            <div class="mt-4 text-center">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-blue-400 underline">L·∫•y API Key mi·ªÖn ph√≠ t·∫°i ƒë√¢y</a>
            </div>
        </div>
    </div>

    <header class="border-b border-gray-800 bg-darkbg/80 sticky top-0 z-40 backdrop-blur-md">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-lg font-bold text-white">YBNThumb <span class="text-blue-500">2.0</span></h1>
            <button onclick="clearKey()" class="text-xs text-gray-500 hover:text-white">ƒê·ªïi Key</button>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-8">

        <section id="step1" class="mb-10">
            <div class="bg-darkcard border border-gray-800 rounded-2xl p-6">
                <label class="block text-sm font-medium text-blue-400 mb-2">√ù t∆∞·ªüng Video / Ch·ªß ƒë·ªÅ</label>
                <textarea id="videoInput" rows="4" class="w-full bg-[#09090b] border border-gray-800 rounded-xl p-4 text-white focus:border-blue-500 outline-none text-lg" placeholder="V√≠ d·ª•: B√≠ ·∫©n kim t·ª± th√°p, phong c√°ch huy·ªÅn b√≠..."></textarea>
                
                <div class="flex justify-between items-center mt-4">
                     <label class="text-gray-400 text-sm cursor-pointer hover:text-white flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span id="imageLabel">T·∫£i ·∫£nh n·ªÅn (T√πy ch·ªçn)</span>
                        <input type="file" id="imageInput" class="hidden" accept="image/*" onchange="document.getElementById('imageLabel').innerText = this.files[0].name; document.getElementById('imageLabel').classList.add('text-blue-400')">
                    </label>

                    <button onclick="analyzeContent()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold px-6 py-2 rounded-xl transition">
                        Ph√¢n t√≠ch T∆∞ duy AI üß†
                    </button>
                </div>
            </div>
        </section>

        <div id="loadingUI" class="hidden flex flex-col items-center justify-center py-10">
            <div class="loader mb-4"></div>
            <p class="text-gray-400 animate-pulse">Gemini 2.0 ƒëang suy lu·∫≠n...</p>
        </div>

        <section id="step2" class="hidden space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-darkcard border border-gray-800 p-4 rounded-xl">
                    <h3 class="text-blue-500 font-bold text-xs uppercase mb-2">Chi·∫øn l∆∞·ª£c</h3>
                    <p id="strategyText" class="text-sm text-gray-300"></p>
                </div>
                <div class="bg-darkcard border border-gray-800 p-4 rounded-xl">
                    <h3 class="text-purple-500 font-bold text-xs uppercase mb-2">T√¢m l√Ω h·ªçc</h3>
                    <p id="reasoningText" class="text-sm text-gray-400 italic"></p>
                </div>
            </div>

            <div id="textOptionsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>

            <div class="bg-darkcard border border-gray-700 rounded-xl overflow-hidden mt-6">
                <div class="bg-gray-800/50 p-3 border-b border-gray-700 flex justify-between">
                    <span class="text-white font-bold text-sm">Prompt Midjourney / DALL-E 3</span>
                    <button onclick="copyText('englishPrompt')" class="text-xs bg-blue-600 px-3 py-1 rounded text-white">Copy</button>
                </div>
                <div class="p-4 bg-black">
                    <p id="englishPrompt" class="text-gray-300 font-mono text-sm leading-relaxed"></p>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full text-center text-gray-500 text-sm py-4 hover:text-white">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
        </section>

    </main>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // === C·∫§U H√åNH QUAN TR·ªåNG: T√™n Model M·ªõi Nh·∫•t ===
        const MODEL_NAME = "gemini-2.0-flash-exp"; 

        window.saveApiKey = function() {
            const key = document.getElementById('apiKeyInput').value;
            if(key) { localStorage.setItem('gemini_api_key', key); document.getElementById('apiKeyModal').classList.add('hidden'); }
        }
        window.clearKey = function() { localStorage.removeItem('gemini_api_key'); location.reload(); }
        window.copyText = function(id) { navigator.clipboard.writeText(document.getElementById(id).innerText); alert("ƒê√£ copy!"); }

        // H√†m l√†m s·∫°ch JSON (Quan tr·ªçng cho Gemini 2.0)
        function cleanJSON(text) {
            const start = text.indexOf('{'); const end = text.lastIndexOf('}');
            if (start !== -1 && end !== -1) return JSON.parse(text.substring(start, end + 1));
            return null;
        }

        window.analyzeContent = async function() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if(!apiKey) return document.getElementById('apiKeyModal').classList.remove('hidden');

            const input = document.getElementById('videoInput').value;
            if(!input) return alert("Vui l√≤ng nh·∫≠p n·ªôi dung!");

            document.getElementById('step1').classList.add('hidden');
            document.getElementById('loadingUI').classList.remove('hidden');

            try {
                const genAI = new GoogleGenerativeAI(apiKey);
                const model = genAI.getGenerativeModel({ model: MODEL_NAME });

                const prompt = `
                Act as a YouTube Expert. Analyze: "${input}".
                Return JSON only:
                {
                    "strategy": "Vietnamese strategy (short)",
                    "reasoning": "Psychology explanation (Vietnamese)",
                    "hooks": ["Hook 1", "Hook 2", "Hook 3"],
                    "midjourney_prompt": "Highly detailed English prompt for thumbnail, 8k, cinematic lighting..."
                }
                `;

                const result = await model.generateContent(prompt);
                const data = cleanJSON(result.response.text());

                if(!data) throw new Error("AI kh√¥ng tr·∫£ v·ªÅ ƒë√∫ng ƒë·ªãnh d·∫°ng.");

                document.getElementById('loadingUI').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');

                document.getElementById('strategyText').innerText = data.strategy;
                document.getElementById('reasoningText').innerText = data.reasoning;
                document.getElementById('englishPrompt').innerText = data.midjourney_prompt + " --ar 16:9 --v 6.0";

                const container = document.getElementById('textOptionsContainer');
                container.innerHTML = '';
                data.hooks.forEach(h => {
                    const div = document.createElement('div');
                    div.className = "p-3 bg-gray-800 rounded-lg text-white text-center text-sm font-bold border border-gray-700";
                    div.innerText = h;
                    container.appendChild(div);
                });

            } catch (e) {
                alert("L·ªói: " + e.message);
                document.getElementById('loadingUI').classList.add('hidden');
                document.getElementById('step1').classList.remove('hidden');
            }
        }

        if(!localStorage.getItem('gemini_api_key')) document.getElementById('apiKeyModal').classList.remove('hidden');
    </script>
</body>
</html>
